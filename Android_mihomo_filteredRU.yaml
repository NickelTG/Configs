unified-delay: true
tcp-concurrent: true
global-client-fingerprint: chrome
keep-alive-interval: 1800

hosts:
  'ntc.party': 130.255.77.28

# –≠—Ç–∏ –¥–æ–º–µ–Ω—ã –ø–æ–π–¥—É—Ç –í–û–û–ë–©–ï –º–∏–º–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è Mihomo
payload:
  - "*.google.com"
  - "*.googleapis.com"
  - "*.gstatic.com"
  - "*.googlevideo.com"
  - "*.googleusercontent.com"
  - "play.google.com"

# –í –±–ª–æ–∫–µ tun (–µ—Å–ª–∏ –≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç skip-proxy)
tun:
  enable: true
  stack: system
  auto-route: true
  auto-detect-interface: true
  # –ü—Ä—è–º–æ–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –∏–∑ —Ç—É–Ω–Ω–µ–ª—è:
  skip-proxy:
    - "geosite:google"
    - "142.250.0.0/15" # –ü–æ–¥—Å–µ—Ç—å Google
    - "172.217.0.0/16" # –ü–æ–¥—Å–µ—Ç—å Google

dns:
  enable: true
  ipv6: false
  enhanced-mode: redir-host # –ü—Ä—è–º–æ–π —Ä–µ–∑–æ–ª–≤ –±–µ–∑ –ø–æ–¥–º–µ–Ω—ã IP
  listen: 0.0.0.0:1053
    
  default-nameserver: # DNS –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è IP —Å–∞–º–∏—Ö –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä–æ–≤ (—Å—Ç—Ä–æ–≥–æ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –∏–ª–∏ –±—ã—Å—Ç—Ä—ã–µ –ª–æ–∫–∞–ª—å–Ω—ã–µ)
    - 8.8.8.8
    - 1.1.1.1
    - 77.88.8.8
  
  nameserver: &main_dns    # –û—Å–Ω–æ–≤–Ω—ã–µ —Å–µ—Ä–≤–µ—Ä—ã —Ä–µ–∑–æ–ª–≤–∞  
    - tls://dns.google    
    - https://dns.quad9.net/dns-query
    - https://cloudflare-dns.com/dns-query
    
  nameserver-policy:
    "geosite:category-ai-!cn":
      - tls://xbox-dns.ru
      - https://router.comss.one/dns-query
      - https://dns.geohide.ru:444/dns-query      
      - tls://dot.dns.astracat.ru
      - tls://dns.mafioznik.xyz
    "rule-set:ru-bundle": *main_dns
    "geoip:ru":
      - tls://common.dot.dns.yandex.net
      - tls://8.8.8.8      
      - 77.88.8.8

proxy-groups:
  - name: VPN
    type: select
    proxies:
      - AUTO
      - BALANCE-HASH    
      - BALANCE-RR      
      - FALLBACK
      - DIRECT

  - name: AUTO
    type: url-test
    url: https://www.youtube.com/generate_204
    interval: 100
    tolerance: 150
    lazy: true
    use: &all_providers     
      - Mah_Eternity
      - AvenCores_24
      - Ebr_Publist
      #- ForceRun_Vless
      - Rooster_Openpr
      #- Zieng2_Universal
      - Y9Felix_Best

  - name: FALLBACK
    type: fallback
    url: https://www.youtube.com/generate_204
    interval: 15
    lazy: false
    use: *all_providers

  - name: BALANCE-HASH
    type: load-balance
    url: https://www.youtube.com/generate_204
    interval: 200
    strategy: consistent-hashing
    use: *all_providers

  - name: BALANCE-RR
    type: load-balance
    url: https://www.youtube.com/generate_204
    interval: 200
    strategy: round-robin
    use: *all_providers
    
  - name: Telegram
    type: select        
    proxies:
      - VPN
      - DIRECT

  - name: YouTube
    type: select        
    proxies:
      - VPN
      - BALANCE-RR      
      - DIRECT      

  - name: AI&DEV
    type: select    
    proxies:     
     - DIRECT
     - VPN

common-settings: &common_filter
  type: http
  interval: 3600  
  filter: "(?i)^(?!.*(RU|Russia|üá∑üá∫|MSK|SPB|[–∞-—è–ê-–Ø]|STR|freak)).*$"
  exclude-filter: "duplicates"
  health-check: {enable: true, url: https://www.gstatic.com/generate_204, interval: 300}    

proxy-providers:    
  Mah_Eternity: { <<: *common_filter, url: "https://raw.githubusercontent.com/mahdibland/ShadowsocksAggregator/master/Eternity.txt", path: ./proxy_providers/eternity.yml, override: {additional-prefix: "ETN-", udp: true, tfo: false, mptcp: false} }
  AvenCores_24: { <<: *common_filter, url: "https://github.com/AvenCores/goida-vpn-configs/raw/refs/heads/main/githubmirror/24.txt", path: ./proxy_providers/sub_24.yml, override: {additional-prefix: "AVE-", udp: true, tfo: false, mptcp: false} }
  Ebr_Publist: { <<: *common_filter, url: "https://raw.githubusercontent.com/ebrasha/free-v2ray-public-list/refs/heads/main/V2Ray-Config-By-EbraSha.txt", path: ./proxy_providers/ebrasha.yml, override: {additional-prefix: "EBR-", udp: true, tfo: false, mptcp: false} }
  #ForceRun_Vless: { <<: *common_filter, url: "https://raw.githubusercontent.com/F0rc3Run/F0rc3Run/refs/heads/main/splitted-by-protocol/vless.txt", path: ./proxy_providers/forcerun_vless.yml, override: {additional-prefix: "FR–°-", udp: true, tfo: true, mptcp: true} }
  Rooster_Openpr: { <<: *common_filter, url: "https://raw.githubusercontent.com/roosterkid/openproxylist/refs/heads/main/V2RAY_RAW.txt", path: ./proxy_providers/rooster.yml, override: {additional-prefix: "RST-", udp: true, tfo: false, mptcp: false} }
  #Zieng2_Universal: { <<: *common_filter, url: "https://raw.githubusercontent.com/zieng2/wl/main/vless_universal.txt", path: ./proxy_providers/vless_universal.yml, override: {additional-prefix: "Zie-", udp: true, tfo: true, mptcp: true} }  
  Y9Felix_Best: { <<: *common_filter, url: "https://raw.githubusercontent.com/y9felix/s/refs/heads/main/b", path: ./proxy_providers/y9felix_best.yml, override: {additional-prefix: "Y9F-", udp: true, tfo: false, mptcp: false} }

rule-providers:
  torrent-trackers: {type: http, behavior: domain, format: mrs, interval: 86400, url: "https://github.com/legiz-ru/mihomo-rule-sets/raw/main/other/torrent-trackers.mrs", path: ./rule-sets/torrent-trackers.mrs}
  torrent-websites: {type: http, behavior: domain, format: mrs, interval: 86400, url: "https://github.com/legiz-ru/mihomo-rule-sets/raw/main/other/torrent-websites.mrs", path: ./rule-sets/torrent-websites.mrs}
  torrent-clients: {type: http, behavior: classical, format: yaml, interval: 86400, url: "https://github.com/legiz-ru/mihomo-rule-sets/raw/main/other/torrent-clients.yaml", path: ./rule-sets/torrent-clients.yaml}    
  youtube: {type: http, behavior: domain, format: mrs, interval: 86400, url: "https://github.com/MetaCubeX/meta-rules-dat/raw/meta/geo/geosite/youtube.mrs", path: ./rule-sets/youtube.mrs}
  telegram_ip: {type: http, behavior: ipcidr, format: text, interval: 86400, url: "https://core.telegram.org/resources/cidr.txt", path: ./rule-sets/telegram_ip.txt}
  oisd_big: {type: http, behavior: domain, format: mrs, interval: 86400, url: "https://github.com/legiz-ru/mihomo-rule-sets/raw/main/oisd/big.mrs", path: ./oisd/big.mrs}
  ru-bundle: {type: http, behavior: domain, format: mrs, interval: 86400, url: "https://github.com/legiz-ru/mihomo-rule-sets/raw/main/ru-bundle/rule.mrs", path: ./ru-bundle/rule.mrs}

rules:  
  - AND,((PROTOCOL,UDP),(DEST-PORT,443)),REJECT
  # –¢–æ—Ä—Ä–µ–Ω—Ç—ã
  - RULE-SET,torrent-clients,DIRECT
  - RULE-SET,torrent-trackers,DIRECT
  - RULE-SET,torrent-websites,VPN
      
  # AI –∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ (–≤—ã—Å—à–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç!)  
  - GEOSITE,category-ai-!cn,AI&DEV
  
  # –°–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–µ—Ç–∏ –∏ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä—ã –∏ YouTube  
  - OR,((GEOSITE,telegram),(RULE-SET,telegram_ip)),Telegram
  - OR,((GEOSITE,meta),(GEOIP,facebook),(PROCESS-NAME,com.whatsapp)),VPN
  - OR,((RULE-SET,youtube),(PROCESS-NAME,app.revanced.android.apps.youtube.music)),YouTube
  
  # –í—Å—è–∫–æ–µ
  - PROCESS-NAME,com.badoo.mobile,VPN
  - PROCESS-NAME,com.bumble.app,VPN  
  - PROCESS-NAME,app.bumpy.android,DIRECT  
  - PROCESS-NAME,com.tantantribe.tribe,VPN
  - DOMAIN,lens-pa.googleapis.com,DIRECT  
  - DOMAIN-SUFFIX,flibusta.site,VPN
  - OR,((DOMAIN-SUFFIX,4pda.to),(DOMAIN-SUFFIX,4pda.ru),(PROCESS-NAME,ru.fourpda.client)),VPN
  - DOMAIN-SUFFIX,habr.com,VPN
  - GEOSITE,google,DIRECT
  
  # –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤ –†–§ —Å–∞–π—Ç—ã
  - RULE-SET,ru-bundle,VPN  

  # –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ IP    
  - OR,((DOMAIN,ipwho.is),(DOMAIN,api.ip.sb),(DOMAIN,ipapi.co),(DOMAIN,ipinfo.io),(DOMAIN,ip-api.com),(DOMAIN,api.myip.com),(DOMAIN,ident.me),(DOMAIN-SUFFIX,2ip.io),(DOMAIN-SUFFIX,2ipcore.com)),VPN
  
  # –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Ä–µ–∫–ª–∞–º—ã
  - RULE-SET,oisd_big,REJECT
  
  # –í–µ—Å—å –æ—Å—Ç–∞–ª—å–Ω–æ–π —Ç—Ä–∞—Ñ–∏–∫ - –Ω–∞–ø—Ä—è–º—É—é  
  - MATCH,DIRECT
