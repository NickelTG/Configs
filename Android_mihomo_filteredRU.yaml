unified-delay: true
tcp-concurrent: true
global-client-fingerprint: chrome
keep-alive-interval: 1000
max-connections: 300

hosts:
  'ntc.party': 130.255.77.28

dns:
  enable: true
  ipv6: false
  enhanced-mode: redir-host # –ü—Ä—è–º–æ–π —Ä–µ–∑–æ–ª–≤ –±–µ–∑ –ø–æ–¥–º–µ–Ω—ã IP
  listen: 0.0.0.0:1053

#dns:
  #enable: true
  #ipv6: false
  #enhanced-mode: fake-ip
  #fake-ip-range: 198.18.0.1/16
  #listen: 0.0.0.0:1053
  #fake-ip-filter:    
    #- "geosite:category-ai-!cn"

  default-nameserver: # DNS –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è IP —Å–∞–º–∏—Ö –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä–æ–≤ (—Å—Ç—Ä–æ–≥–æ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –∏–ª–∏ –±—ã—Å—Ç—Ä—ã–µ –ª–æ–∫–∞–ª—å–Ω—ã–µ)
    - 8.8.8.8    
    - 77.88.8.8
  
  nameserver: &main_dns    # –û—Å–Ω–æ–≤–Ω—ã–µ —Å–µ—Ä–≤–µ—Ä—ã —Ä–µ–∑–æ–ª–≤–∞  
    - tls://8.8.8.8
    - tls://8.8.4.4
    - tls://9.9.9.9
    
  nameserver-policy:
    "geosite:category-ai-!cn":
      - tls://xbox-dns.ru
      - https://router.comss.one/dns-query
      - https://dns.geohide.ru:444/dns-query      
      - tls://dot.dns.astracat.ru
      - tls://dns.mafioznik.xyz
    "rule-set:ru-bundle": *main_dns
    "geoip:ru":
      - tls://common.dot.dns.yandex.net
      - tls://8.8.8.8      
      - 77.88.8.8

# sniffer:
  # enable: true
  # parse-pure-ip: true
  # sniff:
    # TLS:
      # ports: [443, 8443]
      # override-destination: false

proxy-groups:
  - name: VPN
    type: select
    proxies:
      - AUTO
      - BALANCE-HASH    
      - BALANCE-RR      
      - FALLBACK
      - DIRECT

  - name: AUTO
    type: url-test
    url: http://www.gstatic.com/generate_204
    interval: 200
    tolerance: 150
    lazy: true
    include-all: true    

  - name: FALLBACK
    type: fallback
    url: http://www.gstatic.com/generate_204
    interval: 15
    lazy: false
    include-all: true

  - name: BALANCE-HASH
    type: load-balance
    hidden: true
    url: http://www.gstatic.com/generate_204
    interval: 200
    strategy: consistent-hashing
    include-all: true

  - name: BALANCE-RR
    type: load-balance
    hidden: true
    url: http://www.gstatic.com/generate_204
    interval: 200
    strategy: round-robin
    include-all: true
    
  - name: Telegram
    type: select        
    proxies:
      - VPN
      - DIRECT

  - name: YouTube
    type: select        
    proxies:
      - VPN
      - BALANCE-RR      
      - DIRECT      

  - name: AI&DEV
    type: select    
    proxies:     
     - DIRECT
     - VPN

common-settings: &common_filter
  type: http
  interval: 3600
  exclude-type: "ss|shadowsocks|shadowsocksr"
  filter: "(?i)^(?!.*(RU|Russia|üá∑üá∫|MSK|SPB|[–∞-—è–ê-–Ø]|STR|freak)).*$"
  exclude-asn: [9002,12389,42610,25513,8359,51604,31133,34533,3216,28709,20485,201706,41095,13238,50340,49505,48282,1586,47764,41722,24638,28917,44484,39832,39045,48084,48283,42501,25532,28968,31213,41934,48642]
  exclude-filter: "duplicates"
  health-check: {enable: true, url: http://www.gstatic.com/generate_204, interval: 400, concurrency: 5}    

proxy-providers:    
  1st: { <<: *common_filter, url: "https://raw.githubusercontent.com/roosterkid/openproxylist/refs/heads/main/V2RAY_RAW.txt", path: ./proxy_providers/1st.yml, override: {additional-prefix: "1# ", udp: true, tfo: true, mptcp: true} }
  #2nd: { <<: *common_filter, url: "https://raw.githubusercontent.com/y9felix/s/refs/heads/main/b", path: ./proxy_providers/2nd.yml, override: {additional-prefix: "2# ", udp: true, tfo: true, mptcp: true} }
  3rd: { <<: *common_filter, url: "https://raw.githubusercontent.com/ebrasha/free-v2ray-public-list/refs/heads/main/V2Ray-Config-By-EbraSha.txt", path: ./proxy_providers/3rd.yml, override: {additional-prefix: "3# ", udp: true, tfo: true, mptcp: true} }
  #4th: { <<: *common_filter, url: "https://raw.githubusercontent.com/mahdibland/V2RayAggregator/refs/heads/master/Eternity.yml", path: ./proxy_providers/4th.yml, override: {additional-prefix: "4# ", udp: true, tfo: true, mptcp: true} }  
  #5th: { <<: *common_filter, url: "https://raw.githubusercontent.com/zieng2/wl/main/vless_lite.txt", path: ./proxy_providers/5th.yml, override: {additional-prefix: "5# ", udp: true, tfo: true, mptcp: true} }   
  #6th: { <<: *common_filter, url: "https://github.com/AvenCores/goida-vpn-configs/raw/refs/heads/main/githubmirror/24.txt", path: ./proxy_providers/6th.yml, override: {additional-prefix: "6# ", udp: true, tfo: true, mptcp: true} }  
  #7th: { <<: *common_filter, url: "https://raw.githubusercontent.com/F0rc3Run/F0rc3Run/refs/heads/main/splitted-by-protocol/vless.txt", path: ./proxy_providers/7th.yml, override: {additional-prefix: "7# ", udp: true, tfo: true, mptcp: true} }  
  
  #WL1: { <<: *common_filter, url: "https://raw.githubusercontent.com/Kirillo4ka/vpn-configs-for-russia/refs/heads/main/Vless-Rus-Mobile-White-List.txt", path: ./proxy_providers/WL1.yml, override: {additional-prefix: "WL1 ", udp: true, tfo: true, mptcp: true} }
  #WL2: { <<: *common_filter, url: "https://raw.githubusercontent.com/igareck/vpn-configs-for-russia/refs/heads/main/Vless-Reality-White-Lists-Rus-Mobile.txt", path: ./proxy_providers/WL2.yml, override: {additional-prefix: "WL2 ", udp: true, tfo: true, mptcp: true} }

rule-providers:
  torrent-trackers: {type: http, behavior: domain, format: mrs, interval: 86400, url: "https://github.com/legiz-ru/mihomo-rule-sets/raw/main/other/torrent-trackers.mrs", path: ./rule-sets/torrent-trackers.mrs}
  torrent-websites: {type: http, behavior: domain, format: mrs, interval: 86400, url: "https://github.com/legiz-ru/mihomo-rule-sets/raw/main/other/torrent-websites.mrs", path: ./rule-sets/torrent-websites.mrs}
  torrent-clients: {type: http, behavior: classical, format: yaml, interval: 86400, url: "https://github.com/legiz-ru/mihomo-rule-sets/raw/main/other/torrent-clients.yaml", path: ./rule-sets/torrent-clients.yaml}      
  telegram_ip: {type: http, behavior: ipcidr, format: text, interval: 86400, url: "https://core.telegram.org/resources/cidr.txt", path: ./rule-sets/telegram_ip.txt}
  oisd_big: {type: http, behavior: domain, format: mrs, interval: 86400, url: "https://github.com/legiz-ru/mihomo-rule-sets/raw/main/oisd/big.mrs", path: ./oisd/big.mrs}
  ru-bundle: {type: http, behavior: domain, format: mrs, interval: 86400, url: "https://github.com/legiz-ru/mihomo-rule-sets/raw/main/ru-bundle/rule.mrs", path: ./ru-bundle/rule.mrs}

rules:  
  # –¢–æ—Ä—Ä–µ–Ω—Ç—ã
  - RULE-SET,torrent-clients,DIRECT
  - RULE-SET,torrent-trackers,DIRECT
  - RULE-SET,torrent-websites,VPN
  - AND,((NETWORK,UDP),(DST-PORT,443)),REJECT # –ó–∞—Å—Ç–∞–≤–∏—Ç YouTube –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ TCP (–£–±–∏—Ä–∞–µ–º QUIC –ø–æ–ª–Ω–æ—Å—Ç—å—é)
      
  # AI –∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ (–≤—ã—Å—à–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç!)  
  - GEOSITE,category-ai-!cn,AI&DEV
  
  # –°–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–µ—Ç–∏ –∏ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä—ã –∏ YouTube    
  - OR,((GEOSITE,telegram),(RULE-SET,telegram_ip)),Telegram
  - OR,((GEOSITE,meta),(GEOIP,facebook),(PROCESS-NAME,com.whatsapp)),VPN  
  #- AND,((NETWORK,UDP),(GEOSITE,youtube)),REJECT # –ó–∞—Å—Ç–∞–≤–∏—Ç YouTube –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ TCP
  - OR,((GEOSITE,youtube),(PROCESS-NAME,app.revanced.android.apps.youtube.music)),YouTube
  
  # –í—Å—è–∫–æ–µ
  - PROCESS-NAME,com.badoo.mobile,VPN
  - PROCESS-NAME,com.bumble.app,VPN  
  - PROCESS-NAME,app.bumpy.android,DIRECT
  - PROCESS-NAME,com.tantantribe.tribe,VPN
  - PROCESS-NAME,ru.pepper,DIRECT
  - DOMAIN,lens-pa.googleapis.com,DIRECT
  - DOMAIN-SUFFIX,flibusta.site,VPN
  - PROCESS-NAME,com.duolingo,DIRECT
  - OR,((DOMAIN-SUFFIX,4pda.to),(DOMAIN-SUFFIX,4pda.ru),(PROCESS-NAME,ru.fourpda.client)),VPN
  - DOMAIN-SUFFIX,habr.com,VPN
  - GEOSITE,google,DIRECT
  
  # –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤ –†–§ —Å–∞–π—Ç—ã
  - RULE-SET,ru-bundle,VPN  

  # –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ IP    
  - OR,((DOMAIN,ipwho.is),(DOMAIN,api.ip.sb),(DOMAIN,ipapi.co),(DOMAIN,ipinfo.io),(DOMAIN,ip-api.com),(DOMAIN,api.myip.com),(DOMAIN,ident.me),(DOMAIN-SUFFIX,2ip.io),(DOMAIN-SUFFIX,2ipcore.com)),VPN
  
  # –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Ä–µ–∫–ª–∞–º—ã
  #- RULE-SET,oisd_big,REJECT
  
  # –í–µ—Å—å –æ—Å—Ç–∞–ª—å–Ω–æ–π —Ç—Ä–∞—Ñ–∏–∫ - –Ω–∞–ø—Ä—è–º—É—é  
  - MATCH,DIRECT
