unified-delay: true
tcp-concurrent: true
global-client-fingerprint: chrome
keep-alive-interval: 1800

proxy-name-rewrite:
  - match: '(.*)'
    replace: 'TEST: $1'

hosts:
  'ntc.party': 130.255.77.28

dns:
  enable: true
  ipv6: false
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.67.1/16
  listen: 0.0.0.0:1053
  fake-ip-filter:
    - "rule-set:openai,gemini,ai-bundle"
  
  # DNS –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è IP —Å–∞–º–∏—Ö –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä–æ–≤ (—Å—Ç—Ä–æ–≥–æ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –∏–ª–∏ –±—ã—Å—Ç—Ä—ã–µ –ª–æ–∫–∞–ª—å–Ω—ã–µ)
  default-nameserver:
    - 8.8.8.8
    - 1.1.1.1
    - 77.88.8.8

  # –û—Å–Ω–æ–≤–Ω—ã–µ —Å–µ—Ä–≤–µ—Ä—ã —Ä–µ–∑–æ–ª–≤–∞  
  nameserver: &main_dns    
    - tls://dns.google
    - https://cloudflare-dns.com/dns-query
    - https://dns.quad9.net/dns-query
  
  # –ù–∞–ø—Ä–∞–≤–ª—è–µ–º —Ä–æ—Å—Å–∏–π—Å–∫–∏–µ –¥–æ–º–µ–Ω—ã –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—ã–µ DNS –¥–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏ –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö IP
  nameserver-policy:    
    "rule-set:openai,gemini,ai-bundle":
      - tls://dns.geohide.ru
      - tls://dns.astracat.ru
    "rule-set:ru-bundle": *main_dns
    "geoip:ru":
      - tls://common.dot.dns.yandex.net
      - tls://8.8.8.8      
      - 77.88.8.8

proxy-groups:
  - name: VPN
    type: select
    proxies:
      - AUTO
      - BALANCE-HASH    
      - BALANCE-RR      
      - FALLBACK
      - DIRECT

  - name: AUTO
    type: url-test
    url: https://www.youtube.com/generate_204
    interval: 300
    tolerance: 150
    lazy: true
    use: &all_providers
      - Y9Felix_Best
      - AvenCores_24
      - HansThomas_V2Ray
      - Danialsamadi_DE
#      - Zieng2_Universal
      - Firmfox_Proxify

  - name: FALLBACK
    type: fallback
    url: https://www.youtube.com/generate_204
    interval: 15
    lazy: false
    use: *all_providers

  - name: BALANCE-HASH
    type: load-balance
    url: https://www.youtube.com/generate_204
    interval: 300
    strategy: consistent-hashing
    use: *all_providers

  - name: BALANCE-RR
    type: load-balance
    url: https://www.youtube.com/generate_204
    interval: 300
    strategy: round-robin
    use: *all_providers
    
  - name: Telegram
    type: select        
    proxies:
      - VPN
      - DIRECT

  - name: Meta
    type: select    
    proxies:
      - VPN
      - DIRECT

  - name: YouTube
    type: select        
    proxies:
      - VPN
      - BALANCE-RR      
      - DIRECT      

  - name: AI&DEV
    type: select    
    proxies:     
     - DIRECT
     - VPN

common-settings: &common_filter
  type: http
  interval: 3600  
  filter: "(?i)^(?!.*(RU|Russia|üá∑üá∫|MSK|SPB|[–∞-—è–ê-–Ø]|STR|freak)).*$"
#  filter: "(?i)^(?!.*(RU|Russia|üá∑üá∫|MSK|SPB|[–∞-—è–ê-–Ø]|STR|freak|Iran|IR|Turkey|TR|China|CN|Relay|Traffic|Limit|Expire|Test|Direct|Dummy)).*$"
  exclude-filter: "duplicates"
  health-check: {enable: true, url: https://www.gstatic.com/generate_204, interval: 300}
  override: {udp: true,tfo: true, mptcp: true}
  prepend-proxy-name: true

proxy-providers:
  Y9Felix_Best: { <<: *common_filter, url: "https://raw.githubusercontent.com/y9felix/s/refs/heads/main/b", path: ./proxy_providers/y9felix_best.yml }
  AvenCores_24: { <<: *common_filter, url: "https://github.com/AvenCores/goida-vpn-configs/raw/refs/heads/main/githubmirror/24.txt", path: ./proxy_providers/sub_24.yml }
  HansThomas_V2Ray: { <<: *common_filter, url: "https://raw.githubusercontent.com/hans-thomas/v2ray-subscription/master/servers.txt", path: ./proxy_providers/hans_thomas.yml }
  Danialsamadi_DE: { <<: *common_filter, url: "https://raw.githubusercontent.com/Danialsamadi/v2go/main/Splitted-By-Country/DE.txt", path: ./proxy_providers/v2go_de.yml }
#  Zieng2_Universal: { <<: *common_filter, url: "https://raw.githubusercontent.com/zieng2/wl/main/vless_universal.txt", path: ./proxy_providers/vless_universal.yml }
  Firmfox_Proxify: { <<: *common_filter, url: "https://raw.githubusercontent.com/Firmfox/proxify/main/v2ray_configs/mixed/subscription-1.txt", path: ./proxy_providers/proxify_mixed.yml }

rule-providers:
  torrent-trackers: {type: http, behavior: domain, format: mrs, interval: 86400, url: "https://github.com/legiz-ru/mihomo-rule-sets/raw/main/other/torrent-trackers.mrs", path: ./rule-sets/torrent-trackers.mrs}
  torrent-websites: {type: http, behavior: domain, format: mrs, interval: 86400, url: "https://github.com/legiz-ru/mihomo-rule-sets/raw/main/other/torrent-websites.mrs", path: ./rule-sets/torrent-websites.mrs}
  torrent-clients: {type: http, behavior: classical, format: yaml, interval: 86400, url: "https://github.com/legiz-ru/mihomo-rule-sets/raw/main/other/torrent-clients.yaml", path: ./rule-sets/torrent-clients.yaml}
  telegram-domain: {type: http, behavior: domain, format: mrs, interval: 86400, url: "https://github.com/MetaCubeX/meta-rules-dat/raw/refs/heads/meta/geo/geosite/telegram.mrs", path: ./rule-sets/telegram-domain.mrs}
  telegram-ips: {type: http, behavior: ipcidr, format: yaml, interval: 86400, url: "https://raw.githubusercontent.com/OMchik33/custom-rules/refs/heads/main/mihomo/telegram-ips.yaml", path: ./rule-sets/telegram-ips.yaml}
  whatsapp-domain: {type: http, behavior: domain, format: mrs, interval: 86400, url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/whatsapp.mrs", path: ./rule-sets/whatsapp-domain.mrs}
  openai: {type: http, behavior: domain, format: mrs, interval: 86400, url: "https://github.com/MetaCubeX/meta-rules-dat/raw/meta/geo/geosite/openai.mrs", path: ./provider/rule-set/openai.mrs}
  gemini: {type: http, behavior: domain, format: mrs, interval: 86400, url: "https://github.com/MetaCubeX/meta-rules-dat/raw/meta/geo/geosite/google-gemini.mrs", path: ./provider/rule-set/gemini.mrs}
  ai-bundle: {type: http, behavior: domain, format: mrs, interval: 86400, url: "https://github.com/MetaCubeX/meta-rules-dat/raw/meta/geo/geosite/category-ai-!cn.mrs", path: ./provider/rule-set/ai-bundle.mrs}
  youtube: {type: http, behavior: domain, format: mrs, interval: 86400, url: "https://github.com/MetaCubeX/meta-rules-dat/raw/meta/geo/geosite/youtube.mrs", path: ./rule-sets/youtube.mrs}
  oisd_big: {type: http, behavior: domain, format: mrs, interval: 86400, url: "https://github.com/legiz-ru/mihomo-rule-sets/raw/main/oisd/big.mrs", path: ./oisd/big.mrs}
  ru-bundle: {type: http, behavior: domain, format: mrs, interval: 86400, url: "https://github.com/legiz-ru/mihomo-rule-sets/raw/main/ru-bundle/rule.mrs", path: ./ru-bundle/rule.mrs}

rules:  
  # –¢–æ—Ä—Ä–µ–Ω—Ç—ã
  - RULE-SET,torrent-clients,DIRECT
  - RULE-SET,torrent-trackers,DIRECT
  - RULE-SET,torrent-websites,VPN
      
  # AI –∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ (–≤—ã—Å—à–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç!)
  # - RULE-SET,github-ai,AI&DEV
  - OR,((RULE-SET,ai-bundle),(RULE-SET,gemini),(RULE-SET,openai)),AI&DEV  
  
  # –°–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–µ—Ç–∏ –∏ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä—ã –∏ YouTube
  - OR,((RULE-SET,telegram-domain),(RULE-SET,telegram-ips)),Telegram
  - OR,((RULE-SET,whatsapp-domain),(GEOIP,facebook),(PROCESS-NAME,com.whatsapp)),Meta
  - OR,((RULE-SET,youtube),(PROCESS-NAME,app.revanced.android.apps.youtube.music)),YouTube
  
  # –í—Å—è–∫–æ–µ
  - PROCESS-NAME,com.badoo.mobile,VPN
  - PROCESS-NAME,com.bumble.app,VPN  
  - PROCESS-NAME,app.bumpy.android,DIRECT  
  - PROCESS-NAME,com.tantantribe.tribe,VPN
  - DOMAIN,lens-pa.googleapis.com,DIRECT  
  - DOMAIN-SUFFIX,flibusta.site,VPN
  - OR,((DOMAIN-SUFFIX,4pda.to),(DOMAIN-SUFFIX,4pda.ru),(PROCESS-NAME,ru.fourpda.client)),VPN
  - DOMAIN-SUFFIX,habr.com,VPN
  - GEOSITE,google,DIRECT
  
  # –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤ –†–§ —Å–∞–π—Ç—ã
  - RULE-SET,ru-bundle,VPN  
  
  # –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ IP    
  - OR,((DOMAIN,ipwho.is),(DOMAIN,api.ip.sb),(DOMAIN,ipapi.co),(DOMAIN,ipinfo.io),(DOMAIN,ip-api.com),(DOMAIN,ident.me),(DOMAIN-SUFFIX,2ip.io),(DOMAIN-SUFFIX,2ipcore.com)),VPN
  
  # –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Ä–µ–∫–ª–∞–º—ã
#  - RULE-SET,oisd_big,REJECT
  
  # –í–µ—Å—å –æ—Å—Ç–∞–ª—å–Ω–æ–π —Ç—Ä–∞—Ñ–∏–∫ - –Ω–∞–ø—Ä—è–º—É—é  
  - MATCH,DIRECT
