unified-delay: true
tcp-concurrent: true
global-client-fingerprint: chrome
keep-alive-interval: 1000
max-connections: 300

hosts:
  'ntc.party': 130.255.77.28

dns:
  enable: true
  ipv6: false
  enhanced-mode: redir-host
  listen: 0.0.0.0:1053

#dns:
  #enable: true
  #ipv6: false
  #enhanced-mode: fake-ip
  #fake-ip-range: 198.18.0.1/16
  #listen: 0.0.0.0:1053
  #fake-ip-filter:    
    #- "geosite:category-ai-!cn"

  default-nameserver: # DNS –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è IP —Å–∞–º–∏—Ö –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä–æ–≤ (—Å—Ç—Ä–æ–≥–æ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –∏–ª–∏ –±—ã—Å—Ç—Ä—ã–µ –ª–æ–∫–∞–ª—å–Ω—ã–µ)
    - 8.8.8.8    
    - 77.88.8.8
  
  nameserver: &main_dns    # –û—Å–Ω–æ–≤–Ω—ã–µ —Å–µ—Ä–≤–µ—Ä—ã —Ä–µ–∑–æ–ª–≤–∞  
    - tls://8.8.8.8
    - tls://8.8.4.4
    - tls://9.9.9.9
    
  nameserver-policy:
    "geosite:category-ai-!cn":
      - tls://xbox-dns.ru
      - https://router.comss.one/dns-query
      - https://dns.geohide.ru:444/dns-query      
      - tls://dot.dns.astracat.ru
      - tls://dns.mafioznik.xyz
    "rule-set:ru-bundle": *main_dns
    "geoip:ru":
      - tls://common.dot.dns.yandex.net
      - tls://8.8.8.8      
      - 77.88.8.8

#sniffer:
  #enable: true
  #parse-pure-ip: true
  #sniff:
    #TLS:
      #ports: [443, 8443]
      #override-destination: false

proxy-groups:
  - name: VPN
    type: select
    proxies:
      - AUTO
      - FALLBACK
      - BALANCE-HASH    
      - BALANCE-RR      
      - DIRECT

  - name: AUTO
    type: url-test
    url: http://www.gstatic.com/generate_204
    interval: 200
    tolerance: 150
    max-failed-times: 3
    lazy: true
    include-all: true    

  - name: FALLBACK
    type: fallback
    hidden: true
    url: http://www.gstatic.com/generate_204
    interval: 15
    lazy: false
    include-all: true

  - name: BALANCE-HASH
    type: load-balance
    hidden: true
    url: http://www.gstatic.com/generate_204
    interval: 200
    strategy: consistent-hashing
    include-all: true

  - name: BALANCE-RR
    type: load-balance
    hidden: true
    url: http://www.gstatic.com/generate_204
    interval: 200
    strategy: round-robin
    include-all: true
    
  - name: Telegram
    type: select        
    proxies:
      - VPN
      - DIRECT

  - name: YouTube
    type: select        
    proxies:
      - VPN
      - BALANCE-RR      
      - DIRECT
      - WARP

  - name: AI&DEV
    type: select    
    proxies:     
     - DIRECT
     - VPN

proxies:
  - name: WARP
    type: wireguard
    private-key: U983W7x3lEsbf0nY+owkRZ9ENcKW/pNd9tR40qTHooc=
    server: 162.159.192.1
    port: 500
    ip: 172.16.0.2
    public-key: bmXOC+F1FxEMF9dyiK2H5/1SUtzH0JuVo51h2wPfgyo=
    allowed-ips: ['0.0.0.0/0']
    udp: true
    mtu: 1280
    remote-dns-resolve: true
    dns: [1.1.1.1]
    amnezia-wg-option:
      jc: 5
      jmin: 12
      jmax: 48
      s1: 0
      s2: 0
      h1: 1
      h2: 2
      h3: 3
      h4: 4
      i1: <b 0xc2000000011419fa4bb3599f336777de79f81ca9a8d80d91eeec000044c635cef024a885dcb66d1420a91a8c427e87d6cf8e08b563932f449412cddf77d3e2594ea1c7a183c238a89e9adb7ffa57c133e55c59bec101634db90afb83f75b19fe703179e26a31902324c73f82d9354e1ed8da39af610afcb27e6590a44341a0828e5a3d2f0e0f7b0945d7bf3402feea0ee6332e19bdf48ffc387a97227aa97b205a485d282cd66d1c384bafd63dc42f822c4df2109db5b5646c458236ddcc01ae1c493482128bc0830c9e1233f0027a0d262f92b49d9d8abd9a9e0341f6e1214761043c021d7aa8c464b9d865f5fbe234e49626e00712031703a3e23ef82975f014ee1e1dc428521dc23ce7c6c13663b19906240b3efe403cf30559d798871557e4e60e86c29ea4504ed4d9bb8b549d0e8acd6c334c39bb8fb42ede68fb2aadf00cfc8bcc12df03602bbd4fe701d64a39f7ced112951a83b1dbbe6cd696dd3f15985c1b9fef72fa8d0319708b633cc4681910843ce753fac596ed9945d8b839aeff8d3bf0449197bd0bb22ab8efd5d63eb4a95db8d3ffc796ed5bcf2f4a136a8a36c7a0c65270d511aebac733e61d414050088a1c3d868fb52bc7e57d3d9fd132d78b740a6ecdc6c24936e92c28672dbe00928d89b891865f885aeb4c4996d50c2bbbb7a99ab5de02ac89b3308e57bcecf13f2da0333d1420e18b66b4c23d625d836b538fc0c221d6bd7f566a31fa292b85be96041d8e0bfe655d5dc1afed23eb8f2b3446561bbee7644325cc98d31cea38b865bdcc507e48c6ebdc7553be7bd6ab963d5a14615c4b81da7081c127c791224853e2d19bafdc0d9f3f3a6de898d14abb0e2bc849917e0a599ed4a541268ad0e60ea4d147dc33d17fa82f22aa505ccb53803a31d10a7ca2fea0b290a52ee92c7bf4aab7cea4e3c07b1989364eed87a3c6ba65188cd349d37ce4eefde9ec43bab4b4dc79e03469c2ad6b902e28e0bbbbf696781ad4edf424ffb35ce0236d373629008f142d04b5e08a124237e03e3149f4cdde92d7fae581a1ac332e26b2c9c1a6bdec5b3a9c7a2a870f7a0c25fc6ce245e029b686e346c6d862ad8df6d9b62474fbc31dbb914711f78074d4441f4e6e9edca3c52315a5c0653856e23f681558d669f4a4e6915bcf42b56ce36cb7dd3983b0b1d6fdf0f8efddb68e7ca0ae9dd4570fe6978fbb524109f6ec957ca61f1767ef74eb803b0f16abd0087cf2d01bc1db1c01d97ac81b3196c934586963fe7cf2d310e0739621e8bd00dc23fded18576d8c8f285d7bb5f43b547af3c76235de8b6f757f817683b2151600b11721219212bf27558edd439e73fce951f61d582320e5f4d6c315c71129b719277fc144bbe8ded25ab6d29b6e189c9bd9b16538faf60cc2aab3c3bb81fc2213657f2dd0ceb9b3b871e1423d8d3e8cc008721ef03b28e0ee7bb66b8f2a2ac01ef88df1f21ed49bf1ce435df31ac34485936172567488812429c269b49ee9e3d99652b51a7a614b7c460bf0d2d64d8349ded7345bedab1ea0a766a8470b1242f38d09f7855a32db39516c2bd4bcc538c52fa3a90c8714d4b006a15d9c7a7d04919a1cab48da7cce0d5de1f9e5f8936cffe469132991c6eb84c5191d1bcf69f70c58d9a7b66846440a9f0eef25ee6ab62715b50ca7bef0bc3013d4b62e1639b5028bdf757454356e9326a4c76dabfb497d451a3a1d2dbd46ec283d255799f72dfe878ae25892e25a2542d3ca9018394d8ca35b53ccd94947a8>     

common-settings: &common_filter
  type: http
  interval: 3600
  exclude-type: "ss|shadowsocks|shadowsocksr"
  filter: "(?i)^(?!.*(RU|Russia|üá∑üá∫|MSK|SPB|[–∞-—è–ê-–Ø]|STR|freak)).*$"
  exclude-filter: "duplicates"
  health-check: {enable: true, url: http://www.gstatic.com/generate_204, interval: 400, concurrency: 5}    

proxy-providers:    
  1st: { <<: *common_filter, url: "https://raw.githubusercontent.com/roosterkid/openproxylist/refs/heads/main/V2RAY_RAW.txt", path: ./proxy_providers/1st.yml, override: {additional-prefix: "1# ", udp: true, tfo: true, mptcp: true} }
  2nd: { <<: *common_filter, url: "https://raw.githubusercontent.com/ebrasha/free-v2ray-public-list/refs/heads/main/V2Ray-Config-By-EbraSha.txt", path: ./proxy_providers/2nd.yml, override: {additional-prefix: "2# ", udp: true, tfo: true, mptcp: true} }
  #3rd: { <<: *common_filter, url: "https://raw.githubusercontent.com/ermaozi/get_subscribe/main/subscribe/v2ray.txt", path: ./proxy_providers/3rd.yml, override: {additional-prefix: "3# ", udp: true, tfo: true, mptcp: true} }
  #4th: { <<: *common_filter, url: "https://raw.githubusercontent.com/ssrsub/ssr/master/v2ray", path: ./proxy_providers/4th.yml, override: {additional-prefix: "4# ", udp: true, tfo: true, mptcp: true} }  
  #5th: { <<: *common_filter, url: "https://raw.githubusercontent.com/y9felix/s/refs/heads/main/b", path: ./proxy_providers/5th.yml, override: {additional-prefix: "5# ", udp: true, tfo: true, mptcp: true} }   
  #6th: { <<: *common_filter, url: "https://raw.githubusercontent.com/Pawdroid/Free-servers/main/sub", path: ./proxy_providers/6th.yml, override: {additional-prefix: "6# ", udp: true, tfo: true, mptcp: true} }  
  #7th: { <<: *common_filter, url: "hhttps://raw.githubusercontent.com/liketolivefree/kobabi/refs/heads/main/sub.txt", path: ./proxy_providers/7th.yml, override: {additional-prefix: "7# ", udp: true, tfo: true, mptcp: true} }  
  8th: { <<: *common_filter, url: "https://subsconv.nickel-account.workers.dev/sub?noru=1&limit=20&url=https://raw.githubusercontent.com/barry-far/V2ray-config/main/Sub1.txt", path: ./proxy_providers/8th.yml, override: {additional-prefix: "8# ", udp: true, tfo: true, mptcp: true} }   
  
  #WL1: { <<: *common_filter, url: "https://raw.githubusercontent.com/Kirillo4ka/vpn-configs-for-russia/refs/heads/main/Vless-Rus-Mobile-White-List.txt", path: ./proxy_providers/WL1.yml, override: {additional-prefix: "WL1 ", udp: true, tfo: true, mptcp: true} }
  #WL2: { <<: *common_filter, url: "https://raw.githubusercontent.com/igareck/vpn-configs-for-russia/refs/heads/main/Vless-Reality-White-Lists-Rus-Mobile.txt", path: ./proxy_providers/WL2.yml, override: {additional-prefix: "WL2 ", udp: true, tfo: true, mptcp: true} }
  #WL3: { <<: *common_filter, url: "https://raw.githubusercontent.com/zieng2/wl/main/vless_lite.txt", path: ./proxy_providers/WL3.yml, override: {additional-prefix: "WL3 ", udp: true, tfo: true, mptcp: true}

rule-providers:
  torrent-trackers: {type: http, behavior: domain, format: mrs, interval: 86400, url: "https://github.com/legiz-ru/mihomo-rule-sets/raw/main/other/torrent-trackers.mrs", path: ./rule-sets/torrent-trackers.mrs}
  torrent-websites: {type: http, behavior: domain, format: mrs, interval: 86400, url: "https://github.com/legiz-ru/mihomo-rule-sets/raw/main/other/torrent-websites.mrs", path: ./rule-sets/torrent-websites.mrs}
  torrent-clients: {type: http, behavior: classical, format: yaml, interval: 86400, url: "https://github.com/legiz-ru/mihomo-rule-sets/raw/main/other/torrent-clients.yaml", path: ./rule-sets/torrent-clients.yaml}      
  telegram_ip: {type: http, behavior: ipcidr, format: text, interval: 86400, url: "https://core.telegram.org/resources/cidr.txt", path: ./rule-sets/telegram_ip.txt}
  oisd_big: {type: http, behavior: domain, format: mrs, interval: 86400, url: "https://github.com/legiz-ru/mihomo-rule-sets/raw/main/oisd/big.mrs", path: ./oisd/big.mrs}
  ru-bundle: {type: http, behavior: domain, format: mrs, interval: 86400, url: "https://github.com/legiz-ru/mihomo-rule-sets/raw/main/ru-bundle/rule.mrs", path: ./ru-bundle/rule.mrs}

rules:  
  # –¢–æ—Ä—Ä–µ–Ω—Ç—ã
  - RULE-SET,torrent-clients,DIRECT
  - RULE-SET,torrent-trackers,DIRECT
  - RULE-SET,torrent-websites,VPN
  - AND,((NETWORK,UDP),(DST-PORT,443)),REJECT # –ó–∞—Å—Ç–∞–≤–∏—Ç YouTube –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ TCP (–£–±–∏—Ä–∞–µ–º QUIC –ø–æ–ª–Ω–æ—Å—Ç—å—é)
      
  # AI –∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ (–≤—ã—Å—à–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç!)  
  - GEOSITE,category-ai-!cn,AI&DEV
  
  # –°–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–µ—Ç–∏ –∏ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä—ã –∏ YouTube
  - OR,((GEOSITE,telegram),(RULE-SET,telegram_ip)),Telegram
  - OR,((GEOSITE,meta),(GEOIP,facebook),(PROCESS-NAME,com.whatsapp)),VPN
  #- AND,((NETWORK,UDP),(GEOSITE,youtube)),REJECT # –ó–∞—Å—Ç–∞–≤–∏—Ç YouTube –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ TCP
  - OR,((GEOSITE,youtube),(PROCESS-NAME,app.revanced.android.apps.youtube.music)),YouTube
  
  # –í—Å—è–∫–æ–µ
  - PROCESS-NAME,com.badoo.mobile,VPN
  - PROCESS-NAME,com.bumble.app,VPN  
  - PROCESS-NAME,app.bumpy.android,DIRECT
  #- PROCESS-NAME,com.tantantribe.tribe,VPN
  - PROCESS-NAME,ru.pepper,DIRECT
  - DOMAIN,lens-pa.googleapis.com,DIRECT
  - DOMAIN-SUFFIX,flibusta.site,VPN
  - PROCESS-NAME,com.duolingo,DIRECT
  - OR,((DOMAIN-SUFFIX,4pda.to),(DOMAIN-SUFFIX,4pda.ru),(PROCESS-NAME,ru.fourpda.client)),VPN
  - DOMAIN-SUFFIX,habr.com,VPN
  - GEOSITE,google,DIRECT
  
  # –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤ –†–§ —Å–∞–π—Ç—ã
  - RULE-SET,ru-bundle,VPN  

  # –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ IP    
  - OR,((DOMAIN,ipwho.is),(DOMAIN,api.ip.sb),(DOMAIN,ipapi.co),(DOMAIN,ipinfo.io),(DOMAIN,ip-api.com),(DOMAIN,api.myip.com),(DOMAIN,ident.me),(DOMAIN-SUFFIX,2ip.io),(DOMAIN-SUFFIX,2ipcore.com)),VPN
  
  # –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Ä–µ–∫–ª–∞–º—ã
  #- RULE-SET,oisd_big,REJECT
  
  # –í–µ—Å—å –æ—Å—Ç–∞–ª—å–Ω–æ–π —Ç—Ä–∞—Ñ–∏–∫ - –Ω–∞–ø—Ä—è–º—É—é  
  - MATCH,DIRECT
