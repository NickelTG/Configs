# --- ГЛОБАЛЬНЫЕ НАСТРОЙКИ ---
unified-delay: true
tcp-concurrent: true
global-client-fingerprint: chrome
keep-alive-interval: 1800

dns:
  enable: true
  ipv6: false
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.67.1/16
  listen: 0.0.0.0:1053
  
  # DNS для определения IP самих прокси-серверов (строго системные или быстрые локальные)
  default-nameserver:
    - 8.8.8.8
    - 1.1.1.1
    - 77.88.8.8

  # Основные серверы резолва  
  nameserver: &main_dns    
    - tls://dns.google
    - https://cloudflare-dns.com/dns-query
    - https://dns.quad9.net/dns-query
  
  # Направляем российские домены на локальные DNS для скорости и корректных IP
  nameserver-policy:
    "rule-set:ru-bundle": *main_dns
    "geoip:ru":
      - tls://common.dot.dns.yandex.net
      - tls://8.8.8.8      
      - 77.88.8.8    

# --- ГРУППЫ ПРОКСИ ---
proxy-groups:
  - name: VPN
    type: select
    proxies:      
      - BALANCE-HASH    
      - BALANCE-RR
      - auto
      - FALLBACK
      - DIRECT

  - name: auto
    type: url-test
    url: http://cp.cloudflare.com/generate_204
    interval: 300
    tolerance: 150
    lazy: true
    use: &all_providers
      - sweden_Soli
      - lithuania_Soli
      - estonia_Soli
      - switzerland_Soli
      - netherlands_Soli
      - latvia_Force
      - austria_Force
      - finland_Force
      - poland_Force
      - austria_danial
#      - belgium_danial
#      - bulgaria_danial
#      - switzerland_danial
#      - czech_danial
#      - germany_danial
#      - denmark_danial
#      - spain_danial
#      - finland_danial
#      - france_danial
#      - united_kingdom_danial
#      - greece_danial
#      - hungary_danial
#      - ireland_danial
#      - italy_danial
#      - luxembourg_danial
#      - latvia_danial
#      - moldova_danial
#      - netherlands_danial
#      - norway_danial
#      - poland_danial
#      - portugal_danial
#      - romania_danial
#      - serbia_danial
#      - sweden_danial

  - name: FALLBACK
    type: fallback
    url: http://cp.cloudflare.com/generate_204
    interval: 60
    use: *all_providers

  - name: BALANCE-HASH
    type: load-balance
    url: http://cp.cloudflare.com/generate_204
    interval: 300
    strategy: consistent-hashing
    use: *all_providers

  - name: BALANCE-RR
    type: load-balance
    url: http://cp.cloudflare.com/generate_204
    interval: 300
    strategy: round-robin
    use: *all_providers

  - name: Telegram
    type: select        
    proxies:
      - VPN
      - DIRECT

  - name: Meta
    type: select    
    proxies:
      - VPN
      - DIRECT

  - name: YouTube
    type: select        
    proxies:
      - BALANCE-RR
      - VPN
      - DIRECT      

  - name: AI&DEV
    type: select    
    proxies:
     - VPN
     - DIRECT
      

# --- ПРОВАЙДЕРЫ ПРОКСИ ---
common-settings: &common_settings
  type: http
  health-check: {enable: true, url: http://cp.cloudflare.com/generate_204, interval: 300}
  override: {udp: true,tfo: true, mptcp: true}
  interval: 43200

proxy-providers:
  sweden_Soli: { <<: *common_settings, url: "https://raw.githubusercontent.com/SoliSpirit/v2ray-configs/refs/heads/main/Countries/Sweden.txt", path: ./pp/se_soli.yml }
  lithuania_Soli: { <<: *common_settings, url: "https://raw.githubusercontent.com/SoliSpirit/v2ray-configs/refs/heads/main/Countries/Lithuania.txt", path: ./pp/lt_soli.yml }
  estonia_Soli: { <<: *common_settings, url: "https://raw.githubusercontent.com/SoliSpirit/v2ray-configs/refs/heads/main/Countries/Estonia.txt", path: ./pp/ee_soli.yml }
  switzerland_Soli: { <<: *common_settings, url: "https://raw.githubusercontent.com/SoliSpirit/v2ray-configs/refs/heads/main/Countries/Switzerland.txt", path: ./pp/ch_soli.yml }
  netherlands_Soli: { <<: *common_settings, url: "https://raw.githubusercontent.com/SoliSpirit/v2ray-configs/refs/heads/main/Countries/The_Netherlands.txt", path: ./pp/nl_soli.yml }
  latvia_Force: { <<: *common_settings, url: "https://raw.githubusercontent.com/F0rc3Run/F0rc3Run/refs/heads/main/splitted-by-country/Latvia.txt", path: ./pp/lv_force.yml }
  austria_Force: { <<: *common_settings, url: "https://raw.githubusercontent.com/F0rc3Run/F0rc3Run/refs/heads/main/splitted-by-country/Austria.txt", path: ./pp/at_force.yml }
  finland_Force: { <<: *common_settings, url: "https://raw.githubusercontent.com/F0rc3Run/F0rc3Run/refs/heads/main/splitted-by-country/Finland.txt", path: ./pp/fi_force.yml }
  poland_Force: { <<: *common_settings, url: "https://raw.githubusercontent.com/F0rc3Run/F0rc3Run/refs/heads/main/splitted-by-country/Poland.txt", path: ./pp/pl_force.yml }
  austria_danial: { <<: *common_settings, url: "https://raw.githubusercontent.com/Danialsamadi/v2go/main/Splitted-By-Country/AT.txt", path: ./pp/at_danial.yml }
#  belgium_danial: { <<: *common_settings, url: "https://raw.githubusercontent.com/Danialsamadi/v2go/main/Splitted-By-Country/BE.txt", path: ./pp/be_danial.yml }
#  bulgaria_danial: { <<: *common_settings, url: "https://raw.githubusercontent.com/Danialsamadi/v2go/main/Splitted-By-Country/BG.txt", path: ./pp/bg_danial.yml }
#  switzerland_danial: { <<: *common_settings, url: "https://raw.githubusercontent.com/Danialsamadi/v2go/main/Splitted-By-Country/CH.txt", path: ./pp/ch_danial.yml }
#  czech_danial: { <<: *common_settings, url: "https://raw.githubusercontent.com/Danialsamadi/v2go/main/Splitted-By-Country/CZ.txt", path: ./pp/cz_danial.yml }
#  germany_danial: { <<: *common_settings, url: "https://raw.githubusercontent.com/Danialsamadi/v2go/main/Splitted-By-Country/DE.txt", path: ./pp/de_danial.yml }
#  denmark_danial: { <<: *common_settings, url: "https://raw.githubusercontent.com/Danialsamadi/v2go/main/Splitted-By-Country/DK.txt", path: ./pp/dk_danial.yml }
#  spain_danial: { <<: *common_settings, url: "https://raw.githubusercontent.com/Danialsamadi/v2go/main/Splitted-By-Country/ES.txt", path: ./pp/es_danial.yml }
#  finland_danial: { <<: *common_settings, url: "https://raw.githubusercontent.com/Danialsamadi/v2go/main/Splitted-By-Country/FI.txt", path: ./pp/fi_danial.yml }
#  france_danial: { <<: *common_settings, url: "https://raw.githubusercontent.com/Danialsamadi/v2go/main/Splitted-By-Country/FR.txt", path: ./pp/fr_danial.yml }
#  united_kingdom_danial: { <<: *common_settings, url: "https://raw.githubusercontent.com/Danialsamadi/v2go/main/Splitted-By-Country/GB.txt", path: ./pp/gb_danial.yml }
#  greece_danial: { <<: *common_settings, url: "https://raw.githubusercontent.com/Danialsamadi/v2go/main/Splitted-By-Country/GR.txt", path: ./pp/gr_danial.yml }
#  hungary_danial: { <<: *common_settings, url: "https://raw.githubusercontent.com/Danialsamadi/v2go/main/Splitted-By-Country/HU.txt", path: ./pp/hu_danial.yml }
#  ireland_danial: { <<: *common_settings, url: "https://raw.githubusercontent.com/Danialsamadi/v2go/main/Splitted-By-Country/IE.txt", path: ./pp/ie_danial.yml }
#  italy_danial: { <<: *common_settings, url: "https://raw.githubusercontent.com/Danialsamadi/v2go/main/Splitted-By-Country/IT.txt", path: ./pp/it_danial.yml }
#  luxembourg_danial: { <<: *common_settings, url: "https://raw.githubusercontent.com/Danialsamadi/v2go/main/Splitted-By-Country/LU.txt", path: ./pp/lu_danial.yml }
#  latvia_danial: { <<: *common_settings, url: "https://raw.githubusercontent.com/Danialsamadi/v2go/main/Splitted-By-Country/LV.txt", path: ./pp/lv_danial.yml }
#  moldova_danial: { <<: *common_settings, url: "https://raw.githubusercontent.com/Danialsamadi/v2go/main/Splitted-By-Country/MD.txt", path: ./pp/md_danial.yml }
#  netherlands_danial: { <<: *common_settings, url: "https://raw.githubusercontent.com/Danialsamadi/v2go/main/Splitted-By-Country/NL.txt", path: ./pp/nl_danial.yml }
#  norway_danial: { <<: *common_settings, url: "https://raw.githubusercontent.com/Danialsamadi/v2go/main/Splitted-By-Country/NO.txt", path: ./pp/no_danial.yml }
#  poland_danial: { <<: *common_settings, url: "https://raw.githubusercontent.com/Danialsamadi/v2go/main/Splitted-By-Country/PL.txt", path: ./pp/pl_danial.yml }
#  portugal_danial: { <<: *common_settings, url: "https://raw.githubusercontent.com/Danialsamadi/v2go/main/Splitted-By-Country/PT.txt", path: ./pp/pt_danial.yml }
#  romania_danial: { <<: *common_settings, url: "https://raw.githubusercontent.com/Danialsamadi/v2go/main/Splitted-By-Country/RO.txt", path: ./pp/ro_danial.yml }
#  serbia_danial: { <<: *common_settings, url: "https://raw.githubusercontent.com/Danialsamadi/v2go/main/Splitted-By-Country/RS.txt", path: ./pp/rs_danial.yml }
#  sweden_danial: { <<: *common_settings, url: "https://raw.githubusercontent.com/Danialsamadi/v2go/main/Splitted-By-Country/SE.txt", path: ./pp/se_danial.yml }

# --- ПРОВАЙДЕРЫ ПРАВИЛ ---
rule-providers:

  torrent-trackers:
    type: http
    behavior: domain
    format: mrs
    url: https://github.com/legiz-ru/mihomo-rule-sets/raw/main/other/torrent-trackers.mrs
    path: ./rule-sets/torrent-trackers.mrs
    interval: 86400
  
  torrent-websites:
    type: http
    behavior: domain
    format: mrs
    url: https://github.com/legiz-ru/mihomo-rule-sets/raw/main/other/torrent-websites.mrs
    path: ./rule-sets/torrent-websites.mrs
    interval: 86400
  
  torrent-clients:
    type: http
    behavior: classical
    format: yaml
    url: https://github.com/legiz-ru/mihomo-rule-sets/raw/main/other/torrent-clients.yaml
    path: ./rule-sets/torrent-clients.yaml
    interval: 86400

  telegram-domain:
    type: http
    behavior: domain
    format: mrs
    url: https://github.com/MetaCubeX/meta-rules-dat/raw/refs/heads/meta/geo/geosite/telegram.mrs
    path: ./rule-sets/telegram-domain.mrs
    interval: 86400
    
  telegram-ips:
    type: http
    behavior: ipcidr
    format: yaml
    url: https://raw.githubusercontent.com/OMchik33/custom-rules/refs/heads/main/mihomo/telegram-ips.yaml
    path: ./rule-sets/telegram-ips.yaml
    interval: 86400
    
  whatsapp-domain:
    type: http
    behavior: domain
    format: mrs
    url: https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/whatsapp.mrs
    path: ./rule-sets/whatsapp-domain.mrs
    interval: 86400
    
  youtube:
    type: http
    behavior: domain
    format: mrs
    url: https://github.com/MetaCubeX/meta-rules-dat/raw/meta/geo/geosite/youtube.mrs
    path: ./rule-sets/youtube.mrs
    interval: 86400    
    
  oisd_big:
    type: http
    behavior: domain
    format: mrs
    url: https://github.com/legiz-ru/mihomo-rule-sets/raw/main/oisd/big.mrs
    path: ./oisd/big.mrs
    interval: 86400

  ru-bundle:
    type: http
    behavior: domain
    format: mrs
    url: https://github.com/legiz-ru/mihomo-rule-sets/raw/main/ru-bundle/rule.mrs
    path: ./ru-bundle/rule.mrs
    interval: 86400

  # AI и разработка (полный набор доменов)
  github-ai:
     type: inline
     behavior: classical    
     payload:
       # GitHub & VS Code
       - DOMAIN-SUFFIX,githubcopilot.com
       - DOMAIN-SUFFIX,github.dev
       - DOMAIN-SUFFIX,github.com
       - DOMAIN-SUFFIX,githubusercontent.com
       - DOMAIN-SUFFIX,copilot-proxy.githubusercontent.com
       - DOMAIN-SUFFIX,telemetry.individual.githubcopilot.com
       - DOMAIN-SUFFIX,main.vscode-cdn.net
       - DOMAIN-SUFFIX,api.github.com
       - DOMAIN-SUFFIX,vscode.dev
       - DOMAIN-SUFFIX,api.individual.githubcopilot.com
       - DOMAIN-SUFFIX,marketplace.visualstudio.com
       - DOMAIN-SUFFIX,vscode-cdn.net
       - DOMAIN-SUFFIX,vscode.microsoft.com
       - DOMAIN-SUFFIX,code.visualstudio.com
       - DOMAIN-KEYWORD,copilot
       - DOMAIN-KEYWORD,vscode
       - DOMAIN-KEYWORD,github
      
       # Microsoft AI
       - DOMAIN-SUFFIX,copilot.microsoft.com
       - DOMAIN-SUFFIX,bing.com
       - DOMAIN-SUFFIX,microsoftcopilot.app
       - DOMAIN-SUFFIX,sydney.bing.com
       - DOMAIN-SUFFIX,edgeservices.bing.com
       - DOMAIN-SUFFIX,copilot.live.com
      
       # OpenAI
       - DOMAIN-SUFFIX,openai.com
       - DOMAIN-SUFFIX,api.openai.com
       - DOMAIN-SUFFIX,chat.openai.com
       - DOMAIN-SUFFIX,chatgpt.com
       - DOMAIN-SUFFIX,platform.openai.com
       - DOMAIN-KEYWORD,openai
       - DOMAIN-KEYWORD,chatgpt
      
       # Google AI (Gemini & Bard)
       - DOMAIN-SUFFIX,gemini.google.com
       - DOMAIN-SUFFIX,bard.google.com
       - DOMAIN-SUFFIX,ai.google.dev
       - DOMAIN-SUFFIX,ai.google.com
       - DOMAIN-SUFFIX,makersuite.google.com
       - DOMAIN-SUFFIX,generativeai.google
       - DOMAIN-SUFFIX,aistudio.google.com
       - DOMAIN-KEYWORD,gemini
       - DOMAIN-KEYWORD,bard
      
       # Anthropic Claude
       - DOMAIN-SUFFIX,claude.ai
       - DOMAIN-SUFFIX,anthropic.com
       - DOMAIN-SUFFIX,console.anthropic.com
       - DOMAIN-KEYWORD,claude
       - DOMAIN-KEYWORD,anthropic
      
       # xAI (Grok)
       - DOMAIN-SUFFIX,x.ai
       - DOMAIN-SUFFIX,grok.x.ai
       - DOMAIN-SUFFIX,api.x.ai
       - DOMAIN-KEYWORD,grok
      
       # Perplexity
#       - DOMAIN-SUFFIX,perplexity.ai
#       - DOMAIN-SUFFIX,pplx.ai
#       - DOMAIN-KEYWORD,perplexity
      
       # Hugging Face
       - DOMAIN-SUFFIX,huggingface.co
       - DOMAIN-SUFFIX,hf.co
       - DOMAIN-SUFFIX,huggingface.com
       - DOMAIN-KEYWORD,huggingface
      
       # Midjourney & Creative AI
       - DOMAIN-SUFFIX,midjourney.com
       - DOMAIN-SUFFIX,cdn.midjourney.com
       - DOMAIN-KEYWORD,midjourney
       - DOMAIN-SUFFIX,stability.ai
       - DOMAIN-SUFFIX,stablediffusionweb.com
       - DOMAIN-SUFFIX,dreamstudio.ai
       - DOMAIN-SUFFIX,runwayml.com
       - DOMAIN-SUFFIX,runway.ml
      
       # Character.AI & Others
       - DOMAIN-SUFFIX,character.ai
       - DOMAIN-SUFFIX,beta.character.ai
       - DOMAIN-SUFFIX,replicate.com
       - DOMAIN-SUFFIX,cohere.ai
       - DOMAIN-SUFFIX,cohere.com
      
       # Development Tools
       - DOMAIN-SUFFIX,jetbrains.com
       - DOMAIN-SUFFIX,replit.com
       - DOMAIN-SUFFIX,repl.it
       - DOMAIN-SUFFIX,stackoverflow.com
       - DOMAIN-SUFFIX,docker.com
       - DOMAIN-SUFFIX,docker.io
       - DOMAIN-SUFFIX,npmjs.com
       - DOMAIN-SUFFIX,pypi.org

# --- ПРАВИЛА МАРШРУТИЗАЦИИ ---
rules:
  
  # Торренты
  - RULE-SET,torrent-clients,DIRECT
  - RULE-SET,torrent-trackers,DIRECT
  - RULE-SET,torrent-websites,VPN
  
  # Всякое  
  - PROCESS-NAME,com.badoo.mobile,VPN
  - PROCESS-NAME,com.bumble.app,VPN
  - PROCESS-NAME,ru.fourpda.client,VPN
  - PROCESS-NAME,app.bumpy.android,DIRECT
  - DOMAIN,lens-pa.googleapis.com,DIRECT  
  
  # AI и разработка (высший приоритет!)
  - RULE-SET,github-ai,AI&DEV
  
  # Социальные сети и мессенджеры и YouTube
  - OR,((RULE-SET,telegram-domain),(RULE-SET,telegram-ips)),Telegram  
  - OR,((RULE-SET,whatsapp-domain),(GEOIP,facebook),(PROCESS-NAME,com.whatsapp)),Meta
  - RULE-SET,youtube,YouTube
  
  # Заблокированные в РФ сайты
  - RULE-SET,ru-bundle,VPN
  
  # Инструменты проверки IP    
  - OR,((DOMAIN,ipwho.is),(DOMAIN,api.ip.sb),(DOMAIN,ipapi.co),(DOMAIN,ipinfo.io),(DOMAIN,ip-api.com),(DOMAIN,ident.me),(DOMAIN-SUFFIX,2ip.io),(DOMAIN-SUFFIX,2ipcore.com)),VPN
  
  # Блокировка рекламы
#  - RULE-SET,oisd_big,REJECT
  
  # Весь остальной трафик - напрямую  
  - MATCH,DIRECT
