# --- ГЛОБАЛЬНЫЕ НАСТРОЙКИ ---
unified-delay: true
tcp-concurrent: true
global-client-fingerprint: chrome
keep-alive-interval: 1800

hosts:
  'ntc.party': 130.255.77.28

dns:
  enable: true
  ipv6: false
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.67.1/16
  listen: 0.0.0.0:1053
  fake-ip-filter:
    - "rule-set:openai,gemini,ai-bundle"
  
  # DNS для определения IP самих прокси-серверов (строго системные или быстрые локальные)
  default-nameserver:
    - 8.8.8.8
    - 1.1.1.1
    - 77.88.8.8

  # Основные серверы резолва  
  nameserver:
    - tls://common.dot.dns.yandex.net
    - tls://dns.google
    - https://cloudflare-dns.com/dns-query
    - https://dns.quad9.net/dns-query
    - 77.88.8.8
  
  # Направляем российские домены на локальные DNS для скорости и корректных IP
  nameserver-policy:
    "rule-set:whitelist":
      - tls://common.dot.dns.yandex.net
      - tls://8.8.8.8      
      - 77.88.8.8
      - system

proxy-groups:
  - name: VPN
    type: select
    proxies:
      - AUTO
      - BALANCE-HASH    
      - BALANCE-RR      
      - FALLBACK
      - DIRECT
      - Zieng2VLlite
      - Kirillo4ka
      - IGARECK-MOB
      - IGARECK-CAB

  - name: Zieng2VLlite
    type: select
    use: [Zieng2_VLlite]

  - name: Kirillo4ka
    type: select
    use: [Kir_WhiteList]

  - name: IGARECK-MOB
    type: select
    use: [Igareck_Mobile]

  - name: IGARECK-CAB
    type: select
    use: [Igareck_Cable]

  - name: AUTO
    type: url-test
    url: https://www.gstatic.com/generate_204
    interval: 300
    tolerance: 150
    lazy: true
    use: &all_providers
      - Zieng2_VLlite
      - Kir_WhiteList
      - Igareck_Mobile
      - Igareck_Cable

  - name: FALLBACK
    type: fallback
    url: https://www.gstatic.com/generate_204
    interval: 60
    lazy: false
    use: *all_providers

  - name: BALANCE-HASH
    type: load-balance
    url: https://www.gstatic.com/generate_204
    interval: 300
    strategy: consistent-hashing
    use: *all_providers

  - name: BALANCE-RR
    type: load-balance
    url: https://www.gstatic.com/generate_204
    interval: 300
    strategy: round-robin
    use: *all_providers

common-settings: &common_filter
  type: http
  interval: 3600
  health-check: {enable: true, url: https://www.gstatic.com/generate_204, interval: 300}
  override: {udp: true}

proxy-providers:
  Zieng2_VLlite: { <<: *common_filter, url: "https://raw.githubusercontent.com/zieng2/wl/main/vless_lite.txt", path: ./proxy_providers/vless_lite.yml }
  Kir_WhiteList: { <<: *common_filter, url: "https://raw.githubusercontent.com/Kirillo4ka/vpn-configs-for-russia/refs/heads/main/Vless-Rus-Mobile-White-List.txt", path: ./proxy_providers/kir_wl.yml }
  Igareck_Mobile: { <<: *common_filter, url: "https://raw.githubusercontent.com/igareck/vpn-configs-for-russia/refs/heads/main/Vless-Reality-White-Lists-Rus-Mobile.txt", path: ./proxy_providers/igareck_mob.yml }
  Igareck_Cable: { <<: *common_filter, url: "https://raw.githubusercontent.com/igareck/vpn-configs-for-russia/refs/heads/main/Vless-Reality-White-Lists-Rus-Cable.txt", path: ./proxy_providers/igareck_cable.yml }

rule-providers:
  openai: {type: http, behavior: domain, format: mrs, interval: 86400, url: "https://github.com/MetaCubeX/meta-rules-dat/raw/meta/geo/geosite/openai.mrs", path: ./provider/rule-set/openai.mrs}
  gemini: {type: http, behavior: domain, format: mrs, interval: 86400, url: "https://github.com/MetaCubeX/meta-rules-dat/raw/meta/geo/geosite/google-gemini.mrs", path: ./provider/rule-set/gemini.mrs}
  ai-bundle: {type: http, behavior: domain, format: mrs, interval: 86400, url: "https://github.com/MetaCubeX/meta-rules-dat/raw/meta/geo/geosite/category-ai-!cn.mrs", path: ./provider/rule-set/ai-bundle.mrs}
  oisd_big: {type: http, behavior: domain, format: mrs, interval: 86400, url: "https://github.com/legiz-ru/mihomo-rule-sets/raw/main/oisd/big.mrs", path: ./oisd/big.mrs}
  whitelist_ext: {type: http, behavior: domain, format: text, interval: 86400, url: "https://raw.githubusercontent.com/hxehex/russia-mobile-internet-whitelist/refs/heads/main/whitelist.txt", path: ./provider/rule-set/whitelist_ext.txt}
  
  whitelist:
    type: inline
    behavior: classical
    payload:
      - DOMAIN-SUFFIX,gosuslugi.ru
      - DOMAIN-SUFFIX,yandex.ru
      - DOMAIN-KEYWORD,sberbank
      - DOMAIN-KEYWORD,tinkoff

rules:  
  # Белый список
  - RULE-SET,whitelist,DIRECT
  - RULE-SET,whitelist_ext,DIRECT
  
  # Блокировка рекламы
#  - RULE-SET,oisd_big,REJECT
  
  # Весь остальной трафик - в VPN
  - MATCH,VPN
